<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arhivare – Căutare</title>
<style>
body { font-family: system-ui, sans-serif; margin: 2rem; }
.card { padding: 1rem; border: 1px solid #ddd; border-radius: 12px; }
.row { display: flex; gap: 0.5rem; align-items: center; }
input[type="text"] { flex: 1; padding: .6rem; border: 1px solid #ccc; border-radius: 8px; }
button { padding: .6rem 1rem; border: 0; border-radius: 8px; cursor: pointer; }
ul { list-style: none; padding-left: 0; }
li { padding: .5rem 0; border-bottom: 1px dashed #e5e5e5; }
.muted { color: #666; font-size: .9rem; }
</style>
</head>
<body>
<h1>Arhivare – Căutare</h1>
<div class="card">
<div class="row">
<input id="q" type="text" placeholder="căută companie sau deținător" minlength="2" />
<button id="btn">Caută</button>
</div>
<p class="muted">Minim 2 caractere. Interoghează <code>/search</code> din API.</p>
</div>


<h2>Rezultate</h2>
<ul id="results"></ul>


<script>
const apiBase = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
? 'http://localhost:8000'
: window.location.origin;


async function search() {
const q = document.getElementById('q').value.trim();
const list = document.getElementById('results');
list.innerHTML = '';
if (q.length < 2) { return; }
const res = await fetch(`${apiBase}/search?query=${encodeURIComponent(q)}&skip=0&limit=20`);
if (!res.ok) {
list.innerHTML = `<li>Eroare: ${res.status}</li>`;
return;
}
const data = await res.json();
if (!Array.isArray(data) || !data.length) {
list.innerHTML = '<li>Nimic găsit</li>';
return;
}
for (const item of data) {
const li = document.createElement('li');
li.innerHTML = `<strong>${item.company_name || '—'}</strong><br>
<span class="muted">Deținător: ${item.holder_name || '—'}</span>`;
list.appendChild(li);
}
}


document.getElementById('btn').addEventListener('click', search);
document.getElementById('q').addEventListener('keydown', (e) => {
if (e.key === 'Enter') search();
});
</script>
</body>
</html>
